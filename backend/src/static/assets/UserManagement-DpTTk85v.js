import{r as n,j as e}from"./index-Dll4-el-.js";const k=()=>{const[x,p]=n.useState([]),[h,u]=n.useState([]),[j,g]=n.useState(!0),[c,r]=n.useState(null),[f,d]=n.useState(!1),[U,m]=n.useState(null),[t,i]=n.useState({email:"",full_name:"",phone:"",role:"user",password:""});n.useEffect(()=>{o(),v()},[]);const o=async()=>{try{const s=await fetch("/api/users",{credentials:"include"});if(s.ok){const a=await s.json();p(a.users||[])}else r("שגיאה בטעינת המשתמשים")}catch{r("שגיאה בחיבור לשרת")}},v=async()=>{try{const s=await fetch("/api/users/roles",{credentials:"include"});if(s.ok){const a=await s.json();u(a.roles||[])}}catch(s){console.error("Error fetching roles:",s)}finally{g(!1)}},N=async s=>{s.preventDefault();try{const a=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(a.ok)d(!1),i({email:"",full_name:"",phone:"",role:"user",password:""}),o();else{const l=await a.json();r(l.error||"שגיאה ביצירת המשתמש")}}catch{r("שגיאה בחיבור לשרת")}},b=async(s,a)=>{try{const l=await fetch(`/api/users/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(l.ok)o(),m(null);else{const S=await l.json();r(S.error||"שגיאה בעדכון המשתמש")}}catch{r("שגיאה בחיבור לשרת")}},y=async(s,a)=>{await b(s,{is_active:!a})},w=s=>{const l={admin:{text:"מנהל מערכת",class:"bg-red-100 text-red-800"},manager:{text:"מנהל",class:"bg-blue-100 text-blue-800"},supervisor:{text:"מפקח",class:"bg-purple-100 text-purple-800"},user:{text:"משתמש רגיל",class:"bg-green-100 text-green-800"}}[s]||{text:s,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.class}`,children:l.text})};return j?e.jsx("div",{className:"tech-background min-h-screen",children:e.jsx("div",{className:"p-8 space-y-8 relative z-10",children:e.jsx("div",{className:"icl-card animate-fade-in-up",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx("div",{className:"loading-spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mr-4",children:"טוען משתמשים..."})]})})})}):e.jsx("div",{className:"tech-background min-h-screen",children:e.jsxs("div",{className:"p-8 space-y-8 relative z-10",children:[e.jsx("div",{className:"icl-card animate-fade-in-up",children:e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"ניהול משתמשים"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"ניהול משתמשים והרשאות במערכת"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"icl-primary-button interactive-element ripple-effect",children:[e.jsx("span",{className:"text-lg ml-2",children:"➕"}),"הוסף משתמש"]})]})}),c&&e.jsx("div",{className:"icl-card animate-fade-in-up",children:e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-500 text-xl ml-3",children:"⚠️"}),e.jsx("p",{className:"text-red-800 font-medium",children:c})]})})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"icl-card max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold gradient-text mb-4",children:"הוסף משתמש חדש"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"form-input-group",children:[e.jsx("label",{children:'דוא"ל'}),e.jsx("input",{type:"email",value:t.email,onChange:s=>i({...t,email:s.target.value}),className:"icl-input",required:!0})]}),e.jsxs("div",{className:"form-input-group",children:[e.jsx("label",{children:"שם מלא"}),e.jsx("input",{type:"text",value:t.full_name,onChange:s=>i({...t,full_name:s.target.value}),className:"icl-input",required:!0})]}),e.jsxs("div",{className:"form-input-group",children:[e.jsx("label",{children:"טלפון"}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>i({...t,phone:s.target.value}),className:"icl-input"})]}),e.jsxs("div",{className:"form-input-group",children:[e.jsx("label",{children:"תפקיד"}),e.jsx("select",{value:t.role,onChange:s=>i({...t,role:s.target.value}),className:"icl-input",children:h.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"form-input-group",children:[e.jsx("label",{children:"סיסמה"}),e.jsx("input",{type:"password",value:t.password,onChange:s=>i({...t,password:s.target.value}),className:"icl-input",required:!0})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"icl-secondary-button flex-1",children:"ביטול"}),e.jsx("button",{type:"submit",className:"icl-primary-button flex-1",children:"הוסף משתמש"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:x.map((s,a)=>e.jsx("div",{className:"icl-card icl-card-enhanced animate-fade-in-up",style:{animationDelay:`${a*.1}s`},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.full_name}),w(s.role),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"פעיל":"לא פעיל"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:'דוא"ל:'})," ",s.email]}),s.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"טלפון:"})," ",s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"תאריך הצטרפות:"})," ",new Date(s.created_at).toLocaleDateString("he-IL")]}),s.last_login&&e.jsxs("p",{children:[e.jsx("strong",{children:"התחברות אחרונה:"})," ",new Date(s.last_login).toLocaleDateString("he-IL")]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(s),className:"icl-secondary-button text-sm px-3 py-1",children:"ערוך"}),e.jsx("button",{onClick:()=>y(s.id,s.is_active),className:`text-sm px-3 py-1 rounded ${s.is_active?"bg-red-100 text-red-800 hover:bg-red-200":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:s.is_active?"השבת":"הפעל"})]})]})},s.id))}),x.length===0&&!c&&e.jsxs("div",{className:"icl-card text-center py-16 animate-fade-in-up",children:[e.jsx("div",{className:"text-6xl mb-4",children:"👥"}),e.jsx("div",{className:"text-gray-500 text-xl mb-6",children:"אין משתמשים במערכת"})]})]})})};export{k as default};
